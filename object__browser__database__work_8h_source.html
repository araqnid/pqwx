<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>PQWX: object_browser_database_work.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="pqwx-appicon-48.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">PQWX
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">PostgreSQLclient</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">object_browser_database_work.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="object__browser__database__work_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00007"></a>00007 <span class="preprocessor">#ifndef __object_browser_database_work_h</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#define __object_browser_database_work_h</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;wx/msgdlg.h&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="query__results_8h.html">query_results.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="database__work_8h.html">database_work.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="script__events_8h.html" title="Defines event types used for managing scripting and editors.">script_events.h</a>&quot;</span>
<a name="l00014"></a>00014 
<a name="l00025"></a><a class="code" href="classObjectBrowserWork.html">00025</a> <span class="keyword">class </span><a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> {
<a name="l00026"></a>00026 <span class="keyword">public</span>:
<a name="l00027"></a>00027   <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a>() : sqlDictionary(<a class="code" href="classObjectBrowser.html#a4e7cb6952a5d0efaafd6e8f9ffb58060" title="Gets the SQL dictionary for the object browser.">ObjectBrowser::GetSqlDictionary</a>()) {}
<a name="l00028"></a>00028 
<a name="l00035"></a>00035   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classObjectBrowserWork.html#a8f4975fa54aff8705c059cd9ed88b966" title="Execute work.">operator()</a>() = 0;
<a name="l00041"></a>00041   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classObjectBrowserWork.html#a2c57e9ae2a101884a1b654d6a8ed2998" title="Merge data obtained by work object into object browser.">LoadIntoView</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a> *browser) = 0;
<a name="l00042"></a>00042 <span class="keyword">protected</span>:
<a name="l00043"></a>00043   <a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html" title="Fluent-style named query executor class.">DatabaseWorkWithDictionary::NamedQueryExecutor</a> Query(<span class="keyword">const</span> wxString &amp;name)
<a name="l00044"></a>00044   {
<a name="l00045"></a>00045     <span class="keywordflow">return</span> <a class="code" href="classObjectBrowserWork.html#af51b8b07ad667c1b2a0c2016b77b5055" title="The actual database work object wrapping this.">owner</a>-&gt;<a class="code" href="classDatabaseWorkWithDictionary.html#a03f9e64e2d908a69c7f66c34f4d60322" title="Execute a query.">Query</a>(name);
<a name="l00046"></a>00046   }
<a name="l00047"></a>00047 
<a name="l00051"></a><a class="code" href="classObjectBrowserWork.html#ac3172b237c3a7191ced9fb954a5afe83">00051</a>   wxString <a class="code" href="classObjectBrowserWork.html#ac3172b237c3a7191ced9fb954a5afe83" title="Quote an identified for use in a generated SQL statement.">QuoteIdent</a>(<span class="keyword">const</span> wxString &amp;value) { <span class="keywordflow">return</span> <a class="code" href="classObjectBrowserWork.html#af51b8b07ad667c1b2a0c2016b77b5055" title="The actual database work object wrapping this.">owner</a>-&gt;QuoteIdent(value); }
<a name="l00055"></a><a class="code" href="classObjectBrowserWork.html#aa101aee36774c0d8561c6b912b3f15f9">00055</a>   wxString <a class="code" href="classObjectBrowserWork.html#aa101aee36774c0d8561c6b912b3f15f9" title="Quote an literal string for use in a generated SQL statement.">QuoteLiteral</a>(<span class="keyword">const</span> wxString &amp;value) { <span class="keywordflow">return</span> <a class="code" href="classObjectBrowserWork.html#af51b8b07ad667c1b2a0c2016b77b5055" title="The actual database work object wrapping this.">owner</a>-&gt;QuoteLiteral(value); }
<a name="l00059"></a><a class="code" href="classObjectBrowserWork.html#af51b8b07ad667c1b2a0c2016b77b5055">00059</a>   <a class="code" href="classDatabaseWorkWithDictionary.html" title="Some database work with a SQL dictionary.">DatabaseWorkWithDictionary</a> *<a class="code" href="classObjectBrowserWork.html#af51b8b07ad667c1b2a0c2016b77b5055" title="The actual database work object wrapping this.">owner</a>;
<a name="l00063"></a><a class="code" href="classObjectBrowserWork.html#a6dc215fdc8acaba09aaac3045a61bde8">00063</a>   PGconn *<a class="code" href="classObjectBrowserWork.html#a6dc215fdc8acaba09aaac3045a61bde8" title="The actual libpq connection object.">conn</a>;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keyword">private</span>:
<a name="l00066"></a>00066   <span class="keyword">const</span> <a class="code" href="classVersionedSql.html" title="Associates name strings with SQL statements, with variations based on server version.">VersionedSql</a>&amp; sqlDictionary;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classObjectBrowserDatabaseWork.html" title="Implementation of DatabaseWork that deals with passing results back to the GUI thread.">ObjectBrowserDatabaseWork</a>;
<a name="l00069"></a>00069 };
<a name="l00070"></a>00070 
<a name="l00074"></a><a class="code" href="classObjectBrowserDatabaseWork.html">00074</a> <span class="keyword">class </span><a class="code" href="classObjectBrowserDatabaseWork.html" title="Implementation of DatabaseWork that deals with passing results back to the GUI thread.">ObjectBrowserDatabaseWork</a> : <span class="keyword">public</span> <a class="code" href="classDatabaseWorkWithDictionary.html" title="Some database work with a SQL dictionary.">DatabaseWorkWithDictionary</a> {
<a name="l00075"></a>00075 <span class="keyword">public</span>:
<a name="l00079"></a><a class="code" href="classObjectBrowserDatabaseWork.html#a2358b6b4d96957079499ee97dd1a80e4">00079</a>   <span class="keyword">enum</span> <a class="code" href="classObjectBrowserDatabaseWork.html#a2358b6b4d96957079499ee97dd1a80e4" title="State of this work object.">State</a> { PENDING, EXECUTED, NOTIFIED };
<a name="l00083"></a><a class="code" href="classObjectBrowserDatabaseWork.html#adb77aec71cf6caf7c995ad4fb4f32e02">00083</a>   <a class="code" href="classObjectBrowserDatabaseWork.html#adb77aec71cf6caf7c995ad4fb4f32e02" title="Create work object.">ObjectBrowserDatabaseWork</a>(wxEvtHandler *dest, <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> *work) : <a class="code" href="classDatabaseWorkWithDictionary.html" title="Some database work with a SQL dictionary.">DatabaseWorkWithDictionary</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a>::GetSqlDictionary()), dest(dest), work(work), state(PENDING) {}
<a name="l00084"></a>00084   <span class="keywordtype">void</span> operator()() {
<a name="l00085"></a>00085     ChangeState(PENDING, EXECUTED);
<a name="l00086"></a>00086     work-&gt;<a class="code" href="classObjectBrowserWork.html#af51b8b07ad667c1b2a0c2016b77b5055" title="The actual database work object wrapping this.">owner</a> = <span class="keyword">this</span>;
<a name="l00087"></a>00087     work-&gt;<a class="code" href="classObjectBrowserWork.html#a6dc215fdc8acaba09aaac3045a61bde8" title="The actual libpq connection object.">conn</a> = conn;
<a name="l00088"></a>00088     (*work)();
<a name="l00089"></a>00089     state = EXECUTED;
<a name="l00090"></a>00090   }
<a name="l00091"></a>00091   <span class="keywordtype">void</span> NotifyFinished() {
<a name="l00092"></a>00092     ChangeState(EXECUTED, NOTIFIED);
<a name="l00093"></a>00093     wxCommandEvent event(wxEVT_COMMAND_TEXT_UPDATED, <a class="code" href="object__browser_8h.html#a01b35e2ebb32dc8658451b9bd81c6c08" title="Event ID for database work finishing.">EVENT_WORK_FINISHED</a>);
<a name="l00094"></a>00094     <span class="keyword">event</span>.SetClientData(work);
<a name="l00095"></a>00095     dest-&gt;AddPendingEvent(event);
<a name="l00096"></a>00096   }
<a name="l00100"></a><a class="code" href="classObjectBrowserDatabaseWork.html#a8463d678f1095604bdf0b83ed48bb716">00100</a>   <a class="code" href="classObjectBrowserDatabaseWork.html#a2358b6b4d96957079499ee97dd1a80e4" title="State of this work object.">State</a> <a class="code" href="classObjectBrowserDatabaseWork.html#a8463d678f1095604bdf0b83ed48bb716" title="Get the current state of this work object.">GetState</a>()<span class="keyword"> const </span>{
<a name="l00101"></a>00101     wxCriticalSectionLocker locker(crit);
<a name="l00102"></a>00102     <span class="keywordflow">return</span> state;
<a name="l00103"></a>00103   }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="keyword">private</span>:
<a name="l00106"></a>00106   wxEvtHandler *dest;
<a name="l00107"></a>00107   <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> *work;
<a name="l00108"></a>00108   <span class="keyword">mutable</span> wxCriticalSection crit;
<a name="l00109"></a>00109   <a class="code" href="classObjectBrowserDatabaseWork.html#a2358b6b4d96957079499ee97dd1a80e4" title="State of this work object.">State</a> state;
<a name="l00110"></a>00110   <span class="keywordtype">void</span> ChangeState(<a class="code" href="classObjectBrowserDatabaseWork.html#a2358b6b4d96957079499ee97dd1a80e4" title="State of this work object.">State</a> oldState, <a class="code" href="classObjectBrowserDatabaseWork.html#a2358b6b4d96957079499ee97dd1a80e4" title="State of this work object.">State</a> newState) {
<a name="l00111"></a>00111     wxCriticalSectionLocker locker(crit);
<a name="l00112"></a>00112     wxASSERT(state == oldState);
<a name="l00113"></a>00113     state = newState;
<a name="l00114"></a>00114   }
<a name="l00115"></a>00115 };
<a name="l00116"></a>00116 
<a name="l00120"></a><a class="code" href="classRefreshDatabaseListWork.html">00120</a> <span class="keyword">class </span><a class="code" href="classRefreshDatabaseListWork.html" title="Load server information, database list and role list from server.">RefreshDatabaseListWork</a> : <span class="keyword">public</span> <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> {
<a name="l00121"></a>00121 <span class="keyword">public</span>:
<a name="l00127"></a><a class="code" href="classRefreshDatabaseListWork.html#af38121a2c6e9b30d4b5e1a5bfc5c18d6">00127</a>   <a class="code" href="classRefreshDatabaseListWork.html#af38121a2c6e9b30d4b5e1a5bfc5c18d6" title="Create work object.">RefreshDatabaseListWork</a>(<a class="code" href="classServerModel.html" title="A server.">ServerModel</a> *serverModel, wxTreeItemId serverItem) : serverModel(serverModel), serverItem(serverItem) {
<a name="l00128"></a>00128     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to load database list&quot;</span>), <span class="keyword">this</span>);
<a name="l00129"></a>00129   }
<a name="l00130"></a>00130 <span class="keyword">protected</span>:
<a name="l00131"></a><a class="code" href="classRefreshDatabaseListWork.html#a0180f702b56e1040911da10dcc85a724">00131</a>   <span class="keywordtype">void</span> <a class="code" href="classRefreshDatabaseListWork.html#a0180f702b56e1040911da10dcc85a724" title="Execute work.">operator()</a>() {
<a name="l00132"></a>00132     ReadServer();
<a name="l00133"></a>00133     ReadDatabases();
<a name="l00134"></a>00134     ReadRoles();
<a name="l00135"></a>00135   }
<a name="l00136"></a><a class="code" href="classRefreshDatabaseListWork.html#a84c101745855a2d6dd698582cdaefd9a">00136</a>   <span class="keywordtype">void</span> <a class="code" href="classRefreshDatabaseListWork.html#a84c101745855a2d6dd698582cdaefd9a" title="Merge data obtained by work object into object browser.">LoadIntoView</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a> *ob) {
<a name="l00137"></a>00137     ob-&gt;<a class="code" href="classObjectBrowser.html#a206011bc05879ba732cca38772d29b74" title="Fill in server details after loading from the database.">FillInServer</a>(serverModel, serverItem);
<a name="l00138"></a>00138     ob-&gt;EnsureVisible(serverItem);
<a name="l00139"></a>00139     ob-&gt;SelectItem(serverItem);
<a name="l00140"></a>00140     ob-&gt;Expand(serverItem);
<a name="l00141"></a>00141   }
<a name="l00142"></a>00142 <span class="keyword">private</span>:
<a name="l00143"></a>00143   <a class="code" href="classServerModel.html" title="A server.">ServerModel</a> *serverModel;
<a name="l00144"></a>00144   wxTreeItemId serverItem;
<a name="l00145"></a>00145   wxString serverVersionString;
<a name="l00146"></a>00146   <span class="keywordtype">int</span> serverVersion;
<a name="l00147"></a>00147   <span class="keywordtype">bool</span> usingSSL;
<a name="l00148"></a>00148   <span class="keywordtype">void</span> ReadServer() {
<a name="l00149"></a>00149     serverModel-&gt;<a class="code" href="classServerModel.html#a9a36adbd3f32cd58cb77b1bd9503b6a7" title="Initialise some server parameters.">ReadServerParameters</a>(PQparameterStatus(<a class="code" href="classObjectBrowserWork.html#a6dc215fdc8acaba09aaac3045a61bde8" title="The actual libpq connection object.">conn</a>, <span class="stringliteral">&quot;server_version&quot;</span>), PQserverVersion(<a class="code" href="classObjectBrowserWork.html#a6dc215fdc8acaba09aaac3045a61bde8" title="The actual libpq connection object.">conn</a>), PQgetssl(<a class="code" href="classObjectBrowserWork.html#a6dc215fdc8acaba09aaac3045a61bde8" title="The actual libpq connection object.">conn</a>));
<a name="l00150"></a>00150   }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <span class="keyword">static</span> <span class="keywordtype">bool</span> CollateDatabases(<a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *d1, <a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *d2) {
<a name="l00153"></a>00153     <span class="keywordflow">return</span> d1-&gt;name &lt; d2-&gt;name;
<a name="l00154"></a>00154   }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   <span class="keywordtype">void</span> ReadDatabases() {
<a name="l00157"></a>00157     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> databaseRows = Query(_T(<span class="stringliteral">&quot;Databases&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00158"></a>00158     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = databaseRows.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != databaseRows.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00159"></a>00159       <a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *database = <span class="keyword">new</span> <a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a>();
<a name="l00160"></a>00160       database-&gt;server = serverModel;
<a name="l00161"></a>00161       database-&gt;loaded = <span class="keyword">false</span>;
<a name="l00162"></a>00162       database-&gt;oid = (*iter).ReadOid(0);
<a name="l00163"></a>00163       database-&gt;name = (*iter).ReadText(1);
<a name="l00164"></a>00164       database-&gt;isTemplate = (*iter).ReadBool(2);
<a name="l00165"></a>00165       database-&gt;allowConnections = (*iter).ReadBool(3);
<a name="l00166"></a>00166       database-&gt;havePrivsToConnect = (*iter).ReadBool(4);
<a name="l00167"></a>00167       database-&gt;description = (*iter).ReadText(5);
<a name="l00168"></a>00168       serverModel-&gt;databases.push_back(database);
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170     sort(serverModel-&gt;databases.begin(), serverModel-&gt;databases.end(), CollateDatabases);
<a name="l00171"></a>00171   }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keyword">static</span> <span class="keywordtype">bool</span> CollateRoles(<a class="code" href="classRoleModel.html" title="A server role.">RoleModel</a> *r1, <a class="code" href="classRoleModel.html" title="A server role.">RoleModel</a> *r2) {
<a name="l00174"></a>00174     <span class="keywordflow">return</span> r1-&gt;name &lt; r2-&gt;name;
<a name="l00175"></a>00175   }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177   <span class="keywordtype">void</span> ReadRoles() {
<a name="l00178"></a>00178     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> roleRows = Query(_T(<span class="stringliteral">&quot;Roles&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00179"></a>00179     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = roleRows.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != roleRows.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00180"></a>00180       <a class="code" href="classRoleModel.html" title="A server role.">RoleModel</a> *role = <span class="keyword">new</span> <a class="code" href="classRoleModel.html" title="A server role.">RoleModel</a>();
<a name="l00181"></a>00181       role-&gt;oid = (*iter).ReadOid(0);
<a name="l00182"></a>00182       role-&gt;name = (*iter).ReadText(1);
<a name="l00183"></a>00183       role-&gt;canLogin = (*iter).ReadBool(2);
<a name="l00184"></a>00184       role-&gt;superuser = (*iter).ReadBool(3);
<a name="l00185"></a>00185       role-&gt;description = (*iter).ReadText(4);
<a name="l00186"></a>00186       serverModel-&gt;roles.push_back(role);
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188     sort(serverModel-&gt;roles.begin(), serverModel-&gt;roles.end(), CollateRoles);
<a name="l00189"></a>00189   }
<a name="l00190"></a>00190 };
<a name="l00191"></a>00191 
<a name="l00195"></a><a class="code" href="classLoadDatabaseSchemaWork.html">00195</a> <span class="keyword">class </span><a class="code" href="classLoadDatabaseSchemaWork.html" title="Load schema members (relations and functions) for a database.">LoadDatabaseSchemaWork</a> : <span class="keyword">public</span> <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> {
<a name="l00196"></a>00196 <span class="keyword">public</span>:
<a name="l00203"></a><a class="code" href="classLoadDatabaseSchemaWork.html#a7be09917b30c971ba9cdf0ffac7743d4">00203</a>   <a class="code" href="classLoadDatabaseSchemaWork.html#a7be09917b30c971ba9cdf0ffac7743d4" title="Create work object.">LoadDatabaseSchemaWork</a>(<a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *databaseModel, wxTreeItemId databaseItem, <span class="keywordtype">bool</span> expandAfter) : databaseModel(databaseModel), databaseItem(databaseItem), expandAfter(expandAfter) {
<a name="l00204"></a>00204     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to load schema&quot;</span>), <span class="keyword">this</span>);
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206 <span class="keyword">private</span>:
<a name="l00207"></a>00207   <a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *databaseModel;
<a name="l00208"></a>00208   wxTreeItemId databaseItem;
<a name="l00209"></a>00209   <span class="keywordtype">bool</span> expandAfter;
<a name="l00210"></a>00210 <span class="keyword">protected</span>:
<a name="l00211"></a><a class="code" href="classLoadDatabaseSchemaWork.html#af2b0863e505894227b03a1b705809184">00211</a>   <span class="keywordtype">void</span> <a class="code" href="classLoadDatabaseSchemaWork.html#af2b0863e505894227b03a1b705809184" title="Execute work.">operator()</a>() {
<a name="l00212"></a>00212     LoadRelations();
<a name="l00213"></a>00213     LoadFunctions();
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215   <span class="keywordtype">void</span> LoadRelations() {
<a name="l00216"></a>00216     std::map&lt;wxString, RelationModel::Type&gt; typemap;
<a name="l00217"></a>00217     typemap[_T(<span class="stringliteral">&quot;r&quot;</span>)] = RelationModel::TABLE;
<a name="l00218"></a>00218     typemap[_T(<span class="stringliteral">&quot;v&quot;</span>)] = RelationModel::VIEW;
<a name="l00219"></a>00219     typemap[_T(<span class="stringliteral">&quot;S&quot;</span>)] = RelationModel::SEQUENCE;
<a name="l00220"></a>00220     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> relationRows = Query(_T(<span class="stringliteral">&quot;Relations&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00221"></a>00221     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = relationRows.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != relationRows.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00222"></a>00222       <a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *relation = <span class="keyword">new</span> <a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a>();
<a name="l00223"></a>00223       relation-&gt;database = databaseModel;
<a name="l00224"></a>00224       relation-&gt;schema = (*iter).ReadText(1);
<a name="l00225"></a>00225       relation-&gt;user = !IsSystemSchema(relation-&gt;schema);
<a name="l00226"></a>00226       <span class="keywordflow">if</span> (!(*iter)[0].IsEmpty()) {
<a name="l00227"></a>00227         relation-&gt;oid = (*iter).ReadOid(0);
<a name="l00228"></a>00228         relation-&gt;name = (*iter).ReadText(2);
<a name="l00229"></a>00229         wxString relkind((*iter).ReadText(3));
<a name="l00230"></a>00230         relation-&gt;extension = (*iter).ReadText(4);
<a name="l00231"></a>00231         relation-&gt;type = typemap[relkind];
<a name="l00232"></a>00232       }
<a name="l00233"></a>00233       databaseModel-&gt;relations.push_back(relation);
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235   }
<a name="l00236"></a>00236   <span class="keywordtype">void</span> LoadFunctions() {
<a name="l00237"></a>00237     std::map&lt;wxString, FunctionModel::Type&gt; typemap;
<a name="l00238"></a>00238     typemap[_T(<span class="stringliteral">&quot;f&quot;</span>)] = FunctionModel::SCALAR;
<a name="l00239"></a>00239     typemap[_T(<span class="stringliteral">&quot;ft&quot;</span>)] = FunctionModel::TRIGGER;
<a name="l00240"></a>00240     typemap[_T(<span class="stringliteral">&quot;fs&quot;</span>)] = FunctionModel::RECORDSET;
<a name="l00241"></a>00241     typemap[_T(<span class="stringliteral">&quot;fa&quot;</span>)] = FunctionModel::AGGREGATE;
<a name="l00242"></a>00242     typemap[_T(<span class="stringliteral">&quot;fw&quot;</span>)] = FunctionModel::WINDOW;
<a name="l00243"></a>00243     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> functionRows = Query(_T(<span class="stringliteral">&quot;Functions&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00244"></a>00244     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = functionRows.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != functionRows.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00245"></a>00245       <a class="code" href="classFunctionModel.html" title="A function.">FunctionModel</a> *func = <span class="keyword">new</span> <a class="code" href="classFunctionModel.html" title="A function.">FunctionModel</a>();
<a name="l00246"></a>00246       func-&gt;database = databaseModel;
<a name="l00247"></a>00247       func-&gt;oid = (*iter).ReadOid(0);
<a name="l00248"></a>00248       func-&gt;schema = (*iter).ReadText(1);
<a name="l00249"></a>00249       func-&gt;name = (*iter).ReadText(2);
<a name="l00250"></a>00250       func-&gt;arguments = (*iter).ReadText(3);
<a name="l00251"></a>00251       wxString type((*iter).ReadText(4));
<a name="l00252"></a>00252       func-&gt;extension = (*iter).ReadText(5);
<a name="l00253"></a>00253       wxASSERT_MSG(typemap.find(type) != typemap.end(), type);
<a name="l00254"></a>00254       func-&gt;type = typemap[type];
<a name="l00255"></a>00255       func-&gt;user = !IsSystemSchema(func-&gt;schema);
<a name="l00256"></a>00256       databaseModel-&gt;functions.push_back(func);
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258   }
<a name="l00259"></a><a class="code" href="classLoadDatabaseSchemaWork.html#a84503ec6903336b949e34f9bc0573c4d">00259</a>   <span class="keywordtype">void</span> <a class="code" href="classLoadDatabaseSchemaWork.html#a84503ec6903336b949e34f9bc0573c4d" title="Merge data obtained by work object into object browser.">LoadIntoView</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a> *ob) {
<a name="l00260"></a>00260     ob-&gt;<a class="code" href="classObjectBrowser.html#a640d4b6bf7645fe14253f0fa964b075b" title="Fill in database schema after loading from the database.">FillInDatabaseSchema</a>(databaseModel, databaseItem);
<a name="l00261"></a>00261     <span class="keywordflow">if</span> (expandAfter) ob-&gt;Expand(databaseItem);
<a name="l00262"></a>00262     ob-&gt;SetItemText(databaseItem, databaseModel-&gt;name); <span class="comment">// remove loading message</span>
<a name="l00263"></a>00263   }
<a name="l00264"></a>00264 <span class="keyword">private</span>:
<a name="l00265"></a>00265   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> IsSystemSchema(wxString schema) {
<a name="l00266"></a>00266     <span class="keywordflow">return</span> schema.StartsWith(_T(<span class="stringliteral">&quot;pg_&quot;</span>)) || schema == _T(<span class="stringliteral">&quot;information_schema&quot;</span>);
<a name="l00267"></a>00267   }
<a name="l00268"></a>00268 };
<a name="l00269"></a>00269 
<a name="l00273"></a><a class="code" href="classLoadDatabaseDescriptionsWork.html">00273</a> <span class="keyword">class </span><a class="code" href="classLoadDatabaseDescriptionsWork.html" title="Load descriptions of objects from database.">LoadDatabaseDescriptionsWork</a> : <span class="keyword">public</span> <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> {
<a name="l00274"></a>00274 <span class="keyword">public</span>:
<a name="l00278"></a><a class="code" href="classLoadDatabaseDescriptionsWork.html#aafc1a3884b2251f05b841a4462b4a1e8">00278</a>   <a class="code" href="classLoadDatabaseDescriptionsWork.html#aafc1a3884b2251f05b841a4462b4a1e8">LoadDatabaseDescriptionsWork</a>(<a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *databaseModel) : databaseModel(databaseModel) {
<a name="l00279"></a>00279     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to load schema object descriptions&quot;</span>), <span class="keyword">this</span>);
<a name="l00280"></a>00280   }
<a name="l00281"></a>00281 <span class="keyword">private</span>:
<a name="l00282"></a>00282   <a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *databaseModel;
<a name="l00283"></a>00283   std::map&lt;unsigned long, wxString&gt; descriptions;
<a name="l00284"></a>00284 <span class="keyword">protected</span>:
<a name="l00285"></a><a class="code" href="classLoadDatabaseDescriptionsWork.html#a6e6f989c4dda63a8057cbb0fdc37e508">00285</a>   <span class="keywordtype">void</span> <a class="code" href="classLoadDatabaseDescriptionsWork.html#a6e6f989c4dda63a8057cbb0fdc37e508" title="Execute work.">operator()</a>() {
<a name="l00286"></a>00286     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> rs = Query(_T(<span class="stringliteral">&quot;Object Descriptions&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00287"></a>00287     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = rs.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != rs.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00288"></a>00288       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> oid;
<a name="l00289"></a>00289       wxString description;
<a name="l00290"></a>00290       oid = (*iter).ReadOid(0);
<a name="l00291"></a>00291       description = (*iter).ReadText(1);
<a name="l00292"></a>00292       descriptions[oid] = description;
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294   }
<a name="l00295"></a><a class="code" href="classLoadDatabaseDescriptionsWork.html#a039543b1b027afa16eb4d077b3fda4e4">00295</a>   <span class="keywordtype">void</span> <a class="code" href="classLoadDatabaseDescriptionsWork.html#a039543b1b027afa16eb4d077b3fda4e4" title="Merge data obtained by work object into object browser.">LoadIntoView</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a> *ob) {
<a name="l00296"></a>00296     <span class="keywordtype">int</span> count = 0;
<a name="l00297"></a>00297     <span class="keywordflow">for</span> (std::vector&lt;RelationModel*&gt;::iterator iter = databaseModel-&gt;relations.begin(); iter != databaseModel-&gt;relations.end(); iter++) {
<a name="l00298"></a>00298       std::map&lt;unsigned long, wxString&gt;::const_iterator ptr = descriptions.find((*iter)-&gt;oid);
<a name="l00299"></a>00299       <span class="keywordflow">if</span> (ptr != descriptions.end()) {
<a name="l00300"></a>00300         (*iter)-&gt;description = (*ptr).second;
<a name="l00301"></a>00301         ++count;
<a name="l00302"></a>00302       }
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304     <span class="keywordflow">for</span> (std::vector&lt;FunctionModel*&gt;::iterator iter = databaseModel-&gt;functions.begin(); iter != databaseModel-&gt;functions.end(); iter++) {
<a name="l00305"></a>00305       std::map&lt;unsigned long, wxString&gt;::const_iterator ptr = descriptions.find((*iter)-&gt;oid);
<a name="l00306"></a>00306       <span class="keywordflow">if</span> (ptr != descriptions.end()) {
<a name="l00307"></a>00307         (*iter)-&gt;description = (*ptr).second;
<a name="l00308"></a>00308         ++count;
<a name="l00309"></a>00309       }
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311     wxLogDebug(_T(<span class="stringliteral">&quot;Loaded %d/%lu descriptions&quot;</span>), count, descriptions.size());
<a name="l00312"></a>00312   }
<a name="l00313"></a>00313 };
<a name="l00314"></a>00314 
<a name="l00318"></a><a class="code" href="classIndexSchemaCompletionCallback.html">00318</a> <span class="keyword">class </span><a class="code" href="classIndexSchemaCompletionCallback.html" title="Callback interface to notify some client that the schema index has been built.">IndexSchemaCompletionCallback</a> {
<a name="l00319"></a>00319 <span class="keyword">public</span>:
<a name="l00323"></a>00323   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classIndexSchemaCompletionCallback.html#ad78d4408630f9fe376e6d26e0570f901" title="Called when schema index completed.">Completed</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a> *ob, <a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *db, <span class="keyword">const</span> <a class="code" href="classCatalogueIndex.html" title="Database catalogue search index.">CatalogueIndex</a> *index) = 0;
<a name="l00324"></a>00324 };
<a name="l00325"></a>00325 
<a name="l00329"></a><a class="code" href="classIndexDatabaseSchemaWork.html">00329</a> <span class="keyword">class </span><a class="code" href="classIndexDatabaseSchemaWork.html" title="Build index of database schema for object finder.">IndexDatabaseSchemaWork</a> : <span class="keyword">public</span> <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> {
<a name="l00330"></a>00330 <span class="keyword">public</span>:
<a name="l00335"></a><a class="code" href="classIndexDatabaseSchemaWork.html#a19a626e8a009390ec3ac2f3a74aa30af">00335</a>   <a class="code" href="classIndexDatabaseSchemaWork.html#a19a626e8a009390ec3ac2f3a74aa30af">IndexDatabaseSchemaWork</a>(<a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *database, <a class="code" href="classIndexSchemaCompletionCallback.html" title="Callback interface to notify some client that the schema index has been built.">IndexSchemaCompletionCallback</a> *completion = NULL) : database(database), completion(completion) {
<a name="l00336"></a>00336     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to index schema&quot;</span>), <span class="keyword">this</span>);
<a name="l00337"></a>00337   }
<a name="l00338"></a>00338 <span class="keyword">private</span>:
<a name="l00339"></a>00339   <a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *database;
<a name="l00340"></a>00340   <a class="code" href="classIndexSchemaCompletionCallback.html" title="Callback interface to notify some client that the schema index has been built.">IndexSchemaCompletionCallback</a> *completion;
<a name="l00341"></a>00341   <a class="code" href="classCatalogueIndex.html" title="Database catalogue search index.">CatalogueIndex</a> *catalogueIndex;
<a name="l00342"></a>00342 <span class="keyword">protected</span>:
<a name="l00343"></a><a class="code" href="classIndexDatabaseSchemaWork.html#a9e745a27b4c85b184dff88d76b470655">00343</a>   <span class="keywordtype">void</span> <a class="code" href="classIndexDatabaseSchemaWork.html#a9e745a27b4c85b184dff88d76b470655" title="Execute work.">operator()</a>() {
<a name="l00344"></a>00344     std::map&lt;wxString, CatalogueIndex::Type&gt; typeMap;
<a name="l00345"></a>00345     typeMap[_T(<span class="stringliteral">&quot;t&quot;</span>)] = CatalogueIndex::TABLE;
<a name="l00346"></a>00346     typeMap[_T(<span class="stringliteral">&quot;v&quot;</span>)] = CatalogueIndex::VIEW;
<a name="l00347"></a>00347     typeMap[_T(<span class="stringliteral">&quot;s&quot;</span>)] = CatalogueIndex::SEQUENCE;
<a name="l00348"></a>00348     typeMap[_T(<span class="stringliteral">&quot;f&quot;</span>)] = CatalogueIndex::FUNCTION_SCALAR;
<a name="l00349"></a>00349     typeMap[_T(<span class="stringliteral">&quot;fs&quot;</span>)] = CatalogueIndex::FUNCTION_ROWSET;
<a name="l00350"></a>00350     typeMap[_T(<span class="stringliteral">&quot;ft&quot;</span>)] = CatalogueIndex::FUNCTION_TRIGGER;
<a name="l00351"></a>00351     typeMap[_T(<span class="stringliteral">&quot;fa&quot;</span>)] = CatalogueIndex::FUNCTION_AGGREGATE;
<a name="l00352"></a>00352     typeMap[_T(<span class="stringliteral">&quot;fw&quot;</span>)] = CatalogueIndex::FUNCTION_WINDOW;
<a name="l00353"></a>00353     typeMap[_T(<span class="stringliteral">&quot;T&quot;</span>)] = CatalogueIndex::TYPE;
<a name="l00354"></a>00354     typeMap[_T(<span class="stringliteral">&quot;x&quot;</span>)] = CatalogueIndex::EXTENSION;
<a name="l00355"></a>00355     typeMap[_T(<span class="stringliteral">&quot;O&quot;</span>)] = CatalogueIndex::COLLATION;
<a name="l00356"></a>00356     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> rs = Query(_T(<span class="stringliteral">&quot;IndexSchema&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00357"></a>00357     catalogueIndex = <span class="keyword">new</span> <a class="code" href="classCatalogueIndex.html" title="Database catalogue search index.">CatalogueIndex</a>();
<a name="l00358"></a>00358     catalogueIndex-&gt;<a class="code" href="classCatalogueIndex.html#aac2414c8cce7ed98e2ecd80e6761d8ba" title="Begin indexing.">Begin</a>();
<a name="l00359"></a>00359     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = rs.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != rs.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00360"></a>00360       Oid entityId;
<a name="l00361"></a>00361       wxString typeString;
<a name="l00362"></a>00362       wxString symbol;
<a name="l00363"></a>00363       wxString disambig;
<a name="l00364"></a>00364       entityId = (*iter).ReadOid(0);
<a name="l00365"></a>00365       typeString = (*iter).ReadText(1);
<a name="l00366"></a>00366       symbol = (*iter).ReadText(2);
<a name="l00367"></a>00367       disambig = (*iter).ReadText(3);
<a name="l00368"></a>00368       <span class="keywordtype">bool</span> systemObject;
<a name="l00369"></a>00369       <a class="code" href="classCatalogueIndex.html#aee4c0db4298fd40da1b9978f356ba55e" title="Types of database object.">CatalogueIndex::Type</a> entityType;
<a name="l00370"></a>00370       <span class="keywordflow">if</span> (typeString.Last() == _T(<span class="charliteral">&#39;S&#39;</span>)) {
<a name="l00371"></a>00371         systemObject = <span class="keyword">true</span>;
<a name="l00372"></a>00372         typeString.RemoveLast();
<a name="l00373"></a>00373         wxASSERT(typeMap.count(typeString) &gt; 0);
<a name="l00374"></a>00374         entityType = typeMap[typeString];
<a name="l00375"></a>00375       }
<a name="l00376"></a>00376       <span class="keywordflow">else</span> {
<a name="l00377"></a>00377         systemObject = <span class="keyword">false</span>;
<a name="l00378"></a>00378         wxASSERT(typeMap.count(typeString) &gt; 0);
<a name="l00379"></a>00379         entityType = typeMap[typeString];
<a name="l00380"></a>00380       }
<a name="l00381"></a>00381       catalogueIndex-&gt;<a class="code" href="classCatalogueIndex.html#add1114ab82883c774da62570aa45f057" title="Adds a document to the search index.">AddDocument</a>(<a class="code" href="classCatalogueIndex_1_1Document.html" title="Datum stored in the search index.">CatalogueIndex::Document</a>(entityId, entityType, systemObject, symbol, disambig));
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383     catalogueIndex-&gt;<a class="code" href="classCatalogueIndex.html#aa60c7f9dbb1ed30e9603841b813c6f58" title="Finish indexing.">Commit</a>();
<a name="l00384"></a>00384   }
<a name="l00385"></a><a class="code" href="classIndexDatabaseSchemaWork.html#aa14fe3f61754472f5e276f3f20321a99">00385</a>   <span class="keywordtype">void</span> <a class="code" href="classIndexDatabaseSchemaWork.html#aa14fe3f61754472f5e276f3f20321a99" title="Merge data obtained by work object into object browser.">LoadIntoView</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a> *ob) {
<a name="l00386"></a>00386     database-&gt;catalogueIndex = catalogueIndex;
<a name="l00387"></a>00387     <span class="keywordflow">if</span> (completion) {
<a name="l00388"></a>00388       completion-&gt;<a class="code" href="classIndexSchemaCompletionCallback.html#ad78d4408630f9fe376e6d26e0570f901" title="Called when schema index completed.">Completed</a>(ob, database, catalogueIndex);
<a name="l00389"></a>00389       <span class="keyword">delete</span> completion;
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392 };
<a name="l00393"></a>00393 
<a name="l00397"></a><a class="code" href="classLoadRelationWork.html">00397</a> <span class="keyword">class </span><a class="code" href="classLoadRelationWork.html" title="Load relation details from database.">LoadRelationWork</a> : <span class="keyword">public</span> <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> {
<a name="l00398"></a>00398 <span class="keyword">public</span>:
<a name="l00403"></a><a class="code" href="classLoadRelationWork.html#a0e467faae6377d6f0428d737982944b0">00403</a>   <a class="code" href="classLoadRelationWork.html#a0e467faae6377d6f0428d737982944b0">LoadRelationWork</a>(<a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *relationModel, wxTreeItemId relationItem) : relationModel(relationModel), relationItem(relationItem) {
<a name="l00404"></a>00404     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to load relation&quot;</span>), <span class="keyword">this</span>);
<a name="l00405"></a>00405   }
<a name="l00406"></a>00406 <span class="keyword">private</span>:
<a name="l00407"></a>00407   <a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *relationModel;
<a name="l00408"></a>00408   wxTreeItemId relationItem;
<a name="l00409"></a>00409   std::vector&lt;ColumnModel*&gt; columns;
<a name="l00410"></a>00410   std::vector&lt;IndexModel*&gt; indices;
<a name="l00411"></a>00411   std::vector&lt;TriggerModel*&gt; triggers;
<a name="l00412"></a>00412 <span class="keyword">protected</span>:
<a name="l00413"></a><a class="code" href="classLoadRelationWork.html#a340ac4a68a01beb642e9e883b5e5d040">00413</a>   <span class="keywordtype">void</span> <a class="code" href="classLoadRelationWork.html#a340ac4a68a01beb642e9e883b5e5d040" title="Execute work.">operator()</a>() {
<a name="l00414"></a>00414     ReadColumns();
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (relationModel-&gt;type == RelationModel::TABLE) {
<a name="l00416"></a>00416       ReadIndices();
<a name="l00417"></a>00417       ReadTriggers();
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419   }
<a name="l00420"></a>00420 <span class="keyword">private</span>:
<a name="l00421"></a>00421   <span class="keywordtype">void</span> ReadColumns() {
<a name="l00422"></a>00422     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> attributeRows = Query(_T(<span class="stringliteral">&quot;Columns&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#a65aecb8e1db54190010830e3c2da99a8" title="Add an OID parameter.">OidParam</a>(relationModel-&gt;oid).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00423"></a>00423     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = attributeRows.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != attributeRows.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00424"></a>00424       <a class="code" href="classColumnModel.html" title="A relation column.">ColumnModel</a> *column = <span class="keyword">new</span> <a class="code" href="classColumnModel.html" title="A relation column.">ColumnModel</a>();
<a name="l00425"></a>00425       column-&gt;relation = relationModel;
<a name="l00426"></a>00426       column-&gt;name = (*iter).ReadText(0);
<a name="l00427"></a>00427       column-&gt;type = (*iter).ReadText(1);
<a name="l00428"></a>00428       column-&gt;nullable = (*iter).ReadBool(2);
<a name="l00429"></a>00429       column-&gt;hasDefault = (*iter).ReadBool(3);
<a name="l00430"></a>00430       column-&gt;description = (*iter).ReadText(4);
<a name="l00431"></a>00431       columns.push_back(column);
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433   }
<a name="l00434"></a>00434   <span class="keywordtype">void</span> ReadIndices() {
<a name="l00435"></a>00435     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> indexRows = Query(_T(<span class="stringliteral">&quot;Indices&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#a65aecb8e1db54190010830e3c2da99a8" title="Add an OID parameter.">OidParam</a>(relationModel-&gt;oid).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00436"></a>00436     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = indexRows.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != indexRows.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00437"></a>00437       <a class="code" href="classIndexModel.html" title="An index associated with a table.">IndexModel</a> *index = <span class="keyword">new</span> <a class="code" href="classIndexModel.html" title="An index associated with a table.">IndexModel</a>();
<a name="l00438"></a>00438       index-&gt;name = (*iter).ReadText(0);
<a name="l00439"></a>00439       indices.push_back(index);
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441   }
<a name="l00442"></a>00442   <span class="keywordtype">void</span> ReadTriggers() {
<a name="l00443"></a>00443     <a class="code" href="classQueryResults.html" title="Simple query result set representation.">QueryResults</a> triggerRows = Query(_T(<span class="stringliteral">&quot;Triggers&quot;</span>)).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#a65aecb8e1db54190010830e3c2da99a8" title="Add an OID parameter.">OidParam</a>(relationModel-&gt;oid).<a class="code" href="classDatabaseWorkWithDictionary_1_1NamedQueryExecutor.html#ad5d42847ce5b4c4eaffd5335622eed84" title="Execute query and return result set.">List</a>();
<a name="l00444"></a>00444     <span class="keywordflow">for</span> (<a class="code" href="classQueryResults.html#a8c1e383f16aa03cbd760d6f1e45a6c87" title="Immutable iterator.">QueryResults::const_iterator</a> iter = triggerRows.<a class="code" href="classQueryResults.html#a325d3d307905d3a0ed8b99bc65df66e4" title="Start of iteration space.">begin</a>(); iter != triggerRows.<a class="code" href="classQueryResults.html#af62097c65f111cc846427e2e80d8bb57" title="End of iteration space.">end</a>(); iter++) {
<a name="l00445"></a>00445       <a class="code" href="classTriggerModel.html" title="A trigger associated with a table.">TriggerModel</a> *trigger = <span class="keyword">new</span> <a class="code" href="classTriggerModel.html" title="A trigger associated with a table.">TriggerModel</a>();
<a name="l00446"></a>00446       trigger-&gt;name = (*iter).ReadText(0);
<a name="l00447"></a>00447       triggers.push_back(trigger);
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449   }
<a name="l00450"></a>00450 <span class="keyword">protected</span>:
<a name="l00451"></a><a class="code" href="classLoadRelationWork.html#ad31b8c274dc9fe0f45631cf01f72b1d3">00451</a>   <span class="keywordtype">void</span> <a class="code" href="classLoadRelationWork.html#ad31b8c274dc9fe0f45631cf01f72b1d3" title="Merge data obtained by work object into object browser.">LoadIntoView</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a> *ob) {
<a name="l00452"></a>00452     ob-&gt;<a class="code" href="classObjectBrowser.html#a453fa5d6c14339557bd2f04293d15647" title="Fill in relation details after loading from the database.">FillInRelation</a>(relationModel, relationItem, columns, indices, triggers);
<a name="l00453"></a>00453     ob-&gt;Expand(relationItem);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="comment">// remove &#39;loading...&#39; tag</span>
<a name="l00456"></a>00456     wxString itemText = ob-&gt;GetItemText(relationItem);
<a name="l00457"></a>00457     <span class="keywordtype">int</span> space = itemText.Find(_T(<span class="charliteral">&#39; &#39;</span>));
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (space != wxNOT_FOUND) {
<a name="l00459"></a>00459       ob-&gt;SetItemText(relationItem, itemText.Left(space));
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461   }
<a name="l00462"></a>00462 };
<a name="l00463"></a>00463 
<a name="l00473"></a><a class="code" href="classScriptWork.html">00473</a> <span class="keyword">class </span><a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a> : <span class="keyword">public</span> <a class="code" href="classObjectBrowserWork.html" title="Unit of work to be performed on a database connection for the object browser.">ObjectBrowserWork</a> {
<a name="l00474"></a>00474 <span class="keyword">public</span>:
<a name="l00478"></a><a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24">00478</a>   <span class="keyword">enum</span> <a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24" title="Type of script to produce.">Mode</a> { Create, Alter, Drop, Select, Insert, Update, Delete };
<a name="l00482"></a><a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52">00482</a>   <span class="keyword">enum</span> <a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52" title="Output channel.">Output</a> { Window, File, Clipboard };
<a name="l00483"></a>00483   <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a>(<a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *database, <a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24" title="Type of script to produce.">Mode</a> mode, <a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52" title="Output channel.">Output</a> output) : database(database), mode(mode), output(output) {}
<a name="l00484"></a>00484 <span class="keyword">protected</span>:
<a name="l00485"></a>00485   std::vector&lt;wxString&gt; statements;
<a name="l00486"></a><a class="code" href="classScriptWork.html#a6711f8c813c1a15df02132e5826331b5">00486</a>   <span class="keywordtype">void</span> <a class="code" href="classScriptWork.html#a6711f8c813c1a15df02132e5826331b5" title="Merge data obtained by work object into object browser.">LoadIntoView</a>(<a class="code" href="classObjectBrowser.html" title="The object browser tree control.">ObjectBrowser</a> *ob) {
<a name="l00487"></a>00487     wxString message;
<a name="l00488"></a>00488     <span class="keywordflow">switch</span> (output) {
<a name="l00489"></a>00489     <span class="keywordflow">case</span> Window: {
<a name="l00490"></a>00490       <a class="code" href="classPQWXDatabaseEvent.html" title="A &quot;database event&quot; is a notification event with the context of a database connection and state...">PQWXDatabaseEvent</a> evt(database-&gt;server-&gt;<a class="code" href="classServerModel.html#a365651ea8e6c7b756be784e81ce6619d" title="Server connection details.">conninfo</a>, database-&gt;name, PQWX_ScriptToWindow);
<a name="l00491"></a>00491       wxString script;
<a name="l00492"></a>00492       <span class="keywordflow">for</span> (std::vector&lt;wxString&gt;::iterator iter = statements.begin(); iter != statements.end(); iter++) {
<a name="l00493"></a>00493         script &lt;&lt; *iter &lt;&lt; _T(<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l00494"></a>00494       }
<a name="l00495"></a>00495       evt.SetString(script);
<a name="l00496"></a>00496       ob-&gt;ProcessEvent(evt);
<a name="l00497"></a>00497       <span class="keywordflow">return</span>;
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499       <span class="keywordflow">break</span>;
<a name="l00500"></a>00500     <span class="keywordflow">case</span> File:
<a name="l00501"></a>00501       message &lt;&lt; _T(<span class="stringliteral">&quot;TODO Send to file:\n\n&quot;</span>);
<a name="l00502"></a>00502       <span class="keywordflow">break</span>;
<a name="l00503"></a>00503     <span class="keywordflow">case</span> Clipboard:
<a name="l00504"></a>00504       message &lt;&lt; _T(<span class="stringliteral">&quot;TODO Send to clipboard:\n\n&quot;</span>);
<a name="l00505"></a>00505       <span class="keywordflow">break</span>;
<a name="l00506"></a>00506     <span class="keywordflow">default</span>:
<a name="l00507"></a>00507       wxASSERT(<span class="keyword">false</span>);
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509     <span class="keywordflow">for</span> (std::vector&lt;wxString&gt;::iterator iter = statements.begin(); iter != statements.end(); iter++) {
<a name="l00510"></a>00510       message &lt;&lt; *iter &lt;&lt; _T(<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512     wxLogDebug(_T(<span class="stringliteral">&quot;%s&quot;</span>), message.c_str());
<a name="l00513"></a>00513     wxMessageBox(message);
<a name="l00514"></a>00514   }
<a name="l00515"></a>00515   <a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *database;
<a name="l00516"></a>00516   <span class="keyword">const</span> <a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24" title="Type of script to produce.">Mode</a> mode;
<a name="l00517"></a>00517 <span class="keyword">private</span>:
<a name="l00518"></a>00518   <span class="keyword">const</span> <a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52" title="Output channel.">Output</a> output;
<a name="l00519"></a>00519 };
<a name="l00520"></a>00520 
<a name="l00524"></a><a class="code" href="classDatabaseScriptWork.html">00524</a> <span class="keyword">class </span><a class="code" href="classDatabaseScriptWork.html" title="Produce database scripts.">DatabaseScriptWork</a> : <span class="keyword">public</span> <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a> {
<a name="l00525"></a>00525 <span class="keyword">public</span>:
<a name="l00526"></a>00526   <a class="code" href="classDatabaseScriptWork.html" title="Produce database scripts.">DatabaseScriptWork</a>(<a class="code" href="classDatabaseModel.html" title="A database.">DatabaseModel</a> *database, <a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24" title="Type of script to produce.">ScriptWork::Mode</a> mode, <a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52" title="Output channel.">ScriptWork::Output</a> output) : <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a>(database, mode, output) {
<a name="l00527"></a>00527     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to generate database script&quot;</span>), <span class="keyword">this</span>);
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529 <span class="keyword">protected</span>:
<a name="l00530"></a>00530   <span class="keywordtype">void</span> <a class="code" href="classDatabaseScriptWork.html#a1ba82bf1940cfef4f42ba14dccf4a4d3" title="Execute work.">operator()</a>();
<a name="l00531"></a>00531 };
<a name="l00532"></a>00532 
<a name="l00536"></a><a class="code" href="classTableScriptWork.html">00536</a> <span class="keyword">class </span><a class="code" href="classTableScriptWork.html" title="Produce table scripts.">TableScriptWork</a> : <span class="keyword">public</span> <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a> {
<a name="l00537"></a>00537 <span class="keyword">public</span>:
<a name="l00538"></a>00538   <a class="code" href="classTableScriptWork.html" title="Produce table scripts.">TableScriptWork</a>(<a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *table, <a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24" title="Type of script to produce.">ScriptWork::Mode</a> mode, <a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52" title="Output channel.">ScriptWork::Output</a> output) : <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a>(table-&gt;database, mode, output), table(table) {
<a name="l00539"></a>00539     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to generate table script&quot;</span>), <span class="keyword">this</span>);
<a name="l00540"></a>00540   }
<a name="l00541"></a>00541 <span class="keyword">private</span>:
<a name="l00542"></a>00542   <a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *table;
<a name="l00543"></a>00543 <span class="keyword">protected</span>:
<a name="l00544"></a>00544   <span class="keywordtype">void</span> <a class="code" href="classTableScriptWork.html#a5b71c380bbb5d4892f81337d0973db41" title="Execute work.">operator()</a>();
<a name="l00545"></a>00545 };
<a name="l00546"></a>00546 
<a name="l00550"></a><a class="code" href="classViewScriptWork.html">00550</a> <span class="keyword">class </span><a class="code" href="classViewScriptWork.html" title="Produce view scripts.">ViewScriptWork</a> : <span class="keyword">public</span> <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a> {
<a name="l00551"></a>00551 <span class="keyword">public</span>:
<a name="l00552"></a>00552   <a class="code" href="classViewScriptWork.html" title="Produce view scripts.">ViewScriptWork</a>(<a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *view, <a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24" title="Type of script to produce.">ScriptWork::Mode</a> mode, <a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52" title="Output channel.">ScriptWork::Output</a> output) : <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a>(view-&gt;database, mode, output), view(view) {
<a name="l00553"></a>00553     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to generate view script&quot;</span>), <span class="keyword">this</span>);
<a name="l00554"></a>00554   }
<a name="l00555"></a>00555 <span class="keyword">private</span>:
<a name="l00556"></a>00556   <a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *view;
<a name="l00557"></a>00557 <span class="keyword">protected</span>:
<a name="l00558"></a>00558   <span class="keywordtype">void</span> <a class="code" href="classViewScriptWork.html#a32282d726a4c9d742902975083c57c85" title="Execute work.">operator()</a>();
<a name="l00559"></a>00559 };
<a name="l00560"></a>00560 
<a name="l00564"></a><a class="code" href="classSequenceScriptWork.html">00564</a> <span class="keyword">class </span><a class="code" href="classSequenceScriptWork.html" title="Produce sequence scripts.">SequenceScriptWork</a> : <span class="keyword">public</span> <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a> {
<a name="l00565"></a>00565 <span class="keyword">public</span>:
<a name="l00566"></a>00566   <a class="code" href="classSequenceScriptWork.html" title="Produce sequence scripts.">SequenceScriptWork</a>(<a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *sequence, <a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24" title="Type of script to produce.">ScriptWork::Mode</a> mode, <a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52" title="Output channel.">ScriptWork::Output</a> output) : <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a>(sequence-&gt;database, mode, output), sequence(sequence) {
<a name="l00567"></a>00567     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to generate sequence script&quot;</span>), <span class="keyword">this</span>);
<a name="l00568"></a>00568   }
<a name="l00569"></a>00569 <span class="keyword">private</span>:
<a name="l00570"></a>00570   <a class="code" href="classRelationModel.html" title="A relation - table, view or sequence.">RelationModel</a> *sequence;
<a name="l00571"></a>00571 <span class="keyword">protected</span>:
<a name="l00572"></a>00572   <span class="keywordtype">void</span> <a class="code" href="classSequenceScriptWork.html#a85ebb637fbcfc026b5a62d106e014d03" title="Execute work.">operator()</a>();
<a name="l00573"></a>00573 };
<a name="l00574"></a>00574 
<a name="l00578"></a><a class="code" href="classFunctionScriptWork.html">00578</a> <span class="keyword">class </span><a class="code" href="classFunctionScriptWork.html" title="Produce function scripts.">FunctionScriptWork</a> : <span class="keyword">public</span> <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a> {
<a name="l00579"></a>00579 <span class="keyword">public</span>:
<a name="l00580"></a>00580   <a class="code" href="classFunctionScriptWork.html" title="Produce function scripts.">FunctionScriptWork</a>(<a class="code" href="classFunctionModel.html" title="A function.">FunctionModel</a> *<span class="keyword">function</span>, <a class="code" href="classScriptWork.html#a3de3f672f15c0c45e304c766fbf8cc24" title="Type of script to produce.">ScriptWork::Mode</a> mode, <a class="code" href="classScriptWork.html#a6da5ca176787eb6f786ecac2983a9b52" title="Output channel.">ScriptWork::Output</a> output) : <a class="code" href="classScriptWork.html" title="Generate SQL script for some database item.">ScriptWork</a>(function-&gt;database, mode, output), <span class="keyword">function</span>(<span class="keyword">function</span>) {
<a name="l00581"></a>00581     wxLogDebug(_T(<span class="stringliteral">&quot;%p: work to generate function script&quot;</span>), <span class="keyword">this</span>);
<a name="l00582"></a>00582   }
<a name="l00583"></a>00583 <span class="keyword">private</span>:
<a name="l00584"></a>00584   <a class="code" href="classFunctionModel.html" title="A function.">FunctionModel</a> *<span class="keyword">function</span>;
<a name="l00585"></a>00585 <span class="keyword">protected</span>:
<a name="l00586"></a>00586   <span class="keywordtype">void</span> <a class="code" href="classFunctionScriptWork.html#a38910c39c047e7187ad414ddda2b43b7" title="Execute work.">operator()</a>();
<a name="l00587"></a>00587 <span class="keyword">private</span>:
<a name="l00588"></a>00588   <span class="keyword">struct </span>Typeinfo {
<a name="l00589"></a>00589     wxString schema;
<a name="l00590"></a>00590     wxString name;
<a name="l00591"></a>00591     <span class="keywordtype">int</span> arrayDepth;
<a name="l00592"></a>00592   };
<a name="l00593"></a>00593   std::map&lt;Oid, Typeinfo&gt; FetchTypes(<span class="keyword">const</span> std::vector&lt;Oid&gt; &amp;types1, <span class="keyword">const</span> std::vector&lt;Oid&gt; &amp;types2) {
<a name="l00594"></a>00594     std::set&lt;Oid&gt; typeSet;
<a name="l00595"></a>00595     <span class="keywordflow">for</span> (std::vector&lt;Oid&gt;::const_iterator iter = types1.begin(); iter != types1.end(); iter++) {
<a name="l00596"></a>00596       typeSet.insert(*iter);
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598     <span class="keywordflow">for</span> (std::vector&lt;Oid&gt;::const_iterator iter = types2.begin(); iter != types2.end(); iter++) {
<a name="l00599"></a>00599       typeSet.insert(*iter);
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601     <span class="keywordflow">return</span> FetchTypes(typeSet);
<a name="l00602"></a>00602   }
<a name="l00603"></a>00603   std::map&lt;Oid, Typeinfo&gt; FetchTypes(<span class="keyword">const</span> std::set&lt;Oid&gt; &amp;types);
<a name="l00604"></a>00604 };
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="preprocessor">#endif</span>
<a name="l00607"></a>00607 <span class="preprocessor"></span>
<a name="l00608"></a>00608 <span class="comment">// Local Variables:</span>
<a name="l00609"></a>00609 <span class="comment">// mode: c++</span>
<a name="l00610"></a>00610 <span class="comment">// End:</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 12 2012 01:34:36 for PQWX by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
